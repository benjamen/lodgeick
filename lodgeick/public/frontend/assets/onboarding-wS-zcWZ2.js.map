{"version":3,"file":"onboarding-wS-zcWZ2.js","sources":["../../../../frontend/node_modules/frappe-ui/src/utils/call.js","../../../../frontend/src/stores/onboarding.js"],"sourcesContent":["export default async function call(method, args, options = {}) {\n  if (!args) {\n    args = {}\n  }\n\n  let headers = Object.assign(\n    {\n      Accept: 'application/json',\n      'Content-Type': 'application/json; charset=utf-8',\n      'X-Frappe-Site-Name': window.location.hostname,\n    },\n    options.headers || {},\n  )\n\n  if (window.csrf_token && window.csrf_token !== '{{ csrf_token }}') {\n    headers['X-Frappe-CSRF-Token'] = window.csrf_token\n  }\n\n  let path = method.startsWith('/') ? method : `/api/method/${method}`\n  const res = await fetch(path, {\n    method: 'POST',\n    headers,\n    body: JSON.stringify(args),\n  })\n\n  if (res.ok) {\n    const data = await res.json()\n    if (data.docs || method === 'login') {\n      return data\n    }\n    if (data.exc) {\n      try {\n        console.groupCollapsed(method)\n        console.log(`method: ${method}`)\n        console.log(`params:`, args)\n        let warning = JSON.parse(data.exc)\n        for (let text of warning) {\n          console.log(text)\n        }\n        console.groupEnd()\n      } catch (e) {\n        console.warn('Error printing debug messages', e)\n      }\n    }\n    return data.message\n  } else {\n    let response = await res.text()\n    let error, exception\n    try {\n      error = JSON.parse(response)\n      // eslint-disable-next-line no-empty\n    } catch (e) {}\n    let errorParts = [\n      [method, error.exc_type, error._error_message].filter(Boolean).join(' '),\n    ]\n    if (error.exc) {\n      exception = error.exc\n      try {\n        exception = JSON.parse(exception)[0]\n        console.log(exception)\n        // eslint-disable-next-line no-empty\n      } catch (e) {}\n    }\n    let e = new Error(errorParts.join('\\n'))\n    e.exc_type = error.exc_type\n    e.exc = exception\n    e.status = res.status\n    e.messages = error._server_messages\n      ? JSON.parse(error._server_messages)\n      : []\n    e.messages = e.messages.concat(error.message)\n    e.messages = e.messages.map((m) => {\n      try {\n        return JSON.parse(m).message\n      } catch (error) {\n        return m\n      }\n    })\n    e.messages = e.messages.filter(Boolean)\n    if (!e.messages.length) {\n      e.messages = error._error_message\n        ? [error._error_message]\n        : ['Internal Server Error']\n    }\n\n    if (options.onError) {\n      options.onError({ response: res, status: res.status, error: e })\n    }\n\n    throw e\n  }\n}\n\nexport function createCall(options) {\n  return function customCall(method, args) {\n    return call(method, args, options)\n  }\n}\n","import { defineStore } from 'pinia'\r\nimport { ref, computed } from 'vue'\r\nimport { call } from 'frappe-ui'\r\n\r\nexport const useOnboardingStore = defineStore('onboarding', () => {\r\n  // State\r\n  const currentStep = ref(1)\r\n  const totalSteps = ref(4)\r\n  const isCompleted = ref(false)\r\n  const connectedApps = ref([])\r\n  const selectedIntegrations = ref([])\r\n  const fieldMappings = ref({})\r\n  const isLoadingApps = ref(false)\r\n\r\n  // Available apps for integration (loaded from backend)\r\n  const availableApps = ref([])\r\n\r\n  // Computed\r\n  const progress = computed(() => (currentStep.value / totalSteps.value) * 100)\r\n  const canContinue = computed(() => {\r\n    switch (currentStep.value) {\r\n      case 1: // Auth - handled by route guard\r\n        return true\r\n      case 2: // Connect Apps\r\n        return connectedApps.value.length > 0\r\n      case 3: // Integration\r\n        return selectedIntegrations.value.length > 0\r\n      case 4: // Configuration\r\n        return true // Can always skip\r\n      default:\r\n        return false\r\n    }\r\n  })\r\n\r\n  const hasConnectedApps = computed(() => connectedApps.value.length > 0)\r\n\r\n  // Actions\r\n  async function loadApps() {\r\n    if (availableApps.value.length > 0) return // Already loaded\r\n\r\n    isLoadingApps.value = true\r\n    try {\r\n      const response = await call('lodgeick.api.catalog.get_app_catalog')\r\n\r\n      if (response.success && response.apps) {\r\n        availableApps.value = response.apps.map(app => ({\r\n          id: app.app_name,\r\n          name: app.display_name || app.app_name,\r\n          description: app.description,\r\n          icon: getAppIcon(app.app_name),\r\n          color: getAppColor(app.category),\r\n          logo_url: app.logo_url,\r\n          category: app.category,\r\n          oauth_provider: app.oauth_provider,\r\n          isConnected: false,\r\n          use_cases: app.use_cases || []\r\n        }))\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load apps:', error)\r\n    } finally {\r\n      isLoadingApps.value = false\r\n    }\r\n  }\r\n\r\n  function getAppIcon(appName) {\r\n    const icons = {\r\n      'jira': 'üéØ',\r\n      'slack': 'üí¨',\r\n      'hubspot': 'üé®',\r\n      'google_sheets': 'üìä',\r\n      'salesforce': '‚òÅÔ∏è',\r\n      'mailchimp': '‚úâÔ∏è',\r\n      'xero': 'üíº',\r\n    }\r\n    return icons[appName] || 'üîå'\r\n  }\r\n\r\n  function getAppColor(category) {\r\n    const colors = {\r\n      'CRM': 'bg-orange-500',\r\n      'Communication': 'bg-purple-500',\r\n      'Productivity': 'bg-green-500',\r\n      'Finance': 'bg-blue-600',\r\n      'Marketing': 'bg-yellow-500',\r\n      'Project Management': 'bg-blue-500',\r\n    }\r\n    return colors[category] || 'bg-gray-500'\r\n  }\r\n\r\n  function setStep(step) {\r\n    currentStep.value = step\r\n  }\r\n\r\n  function nextStep() {\r\n    if (currentStep.value < totalSteps.value) {\r\n      currentStep.value++\r\n    }\r\n  }\r\n\r\n  function previousStep() {\r\n    if (currentStep.value > 1) {\r\n      currentStep.value--\r\n    }\r\n  }\r\n\r\n  function connectApp(appId) {\r\n    const app = availableApps.value.find(a => a.id === appId)\r\n    if (app && !app.isConnected) {\r\n      app.isConnected = true\r\n      connectedApps.value.push(appId)\r\n    }\r\n  }\r\n\r\n  function disconnectApp(appId) {\r\n    const app = availableApps.value.find(a => a.id === appId)\r\n    if (app) {\r\n      app.isConnected = false\r\n      connectedApps.value = connectedApps.value.filter(id => id !== appId)\r\n      selectedIntegrations.value = selectedIntegrations.value.filter(\r\n        integration => !integration.includes(appId)\r\n      )\r\n    }\r\n  }\r\n\r\n  function addIntegration(fromApp, toApp) {\r\n    const integrationKey = `${fromApp}-${toApp}`\r\n    if (!selectedIntegrations.value.includes(integrationKey)) {\r\n      selectedIntegrations.value.push(integrationKey)\r\n    }\r\n  }\r\n\r\n  function removeIntegration(integrationKey) {\r\n    selectedIntegrations.value = selectedIntegrations.value.filter(\r\n      key => key !== integrationKey\r\n    )\r\n  }\r\n\r\n  function saveFieldMapping(integrationKey, mapping) {\r\n    fieldMappings.value[integrationKey] = mapping\r\n  }\r\n\r\n  function completeOnboarding() {\r\n    isCompleted.value = true\r\n    // Reset for next time if needed\r\n    currentStep.value = 1\r\n  }\r\n\r\n  function resetOnboarding() {\r\n    currentStep.value = 1\r\n    isCompleted.value = false\r\n    connectedApps.value = []\r\n    selectedIntegrations.value = []\r\n    fieldMappings.value = {}\r\n    availableApps.value.forEach(app => {\r\n      app.isConnected = false\r\n    })\r\n  }\r\n\r\n  return {\r\n    // State\r\n    currentStep,\r\n    totalSteps,\r\n    isCompleted,\r\n    connectedApps,\r\n    selectedIntegrations,\r\n    fieldMappings,\r\n    availableApps,\r\n    isLoadingApps,\r\n\r\n    // Computed\r\n    progress,\r\n    canContinue,\r\n    hasConnectedApps,\r\n\r\n    // Actions\r\n    loadApps,\r\n    setStep,\r\n    nextStep,\r\n    previousStep,\r\n    connectApp,\r\n    disconnectApp,\r\n    addIntegration,\r\n    removeIntegration,\r\n    saveFieldMapping,\r\n    completeOnboarding,\r\n    resetOnboarding,\r\n  }\r\n})\r\n"],"names":["call","_0","_1","__async","method","args","options","headers","path","res","data","warning","text","e","response","error","exception","errorParts","useOnboardingStore","defineStore","currentStep","ref","totalSteps","isCompleted","connectedApps","selectedIntegrations","fieldMappings","isLoadingApps","availableApps","progress","computed","canContinue","hasConnectedApps","loadApps","app","getAppIcon","getAppColor","appName","category","setStep","step","nextStep","previousStep","connectApp","appId","a","disconnectApp","id","integration","addIntegration","fromApp","toApp","integrationKey","removeIntegration","key","saveFieldMapping","mapping","completeOnboarding","resetOnboarding"],"mappings":"mQAAe,SAAeA,EAAKC,EAAQC,EAAoB,QAAAC,EAAA,yBAA5BC,EAAQC,EAAMC,EAAU,CAAA,EAAI,CACxDD,IACHA,EAAO,CAAA,GAGT,IAAIE,EAAU,OAAO,OACnB,CACE,OAAQ,mBACR,eAAgB,kCAChB,qBAAsB,OAAO,SAAS,QAC5C,EACID,EAAQ,SAAW,CAAA,CACvB,EAEM,OAAO,YAAc,OAAO,aAAe,qBAC7CC,EAAQ,qBAAqB,EAAI,OAAO,YAG1C,IAAIC,EAAOJ,EAAO,WAAW,GAAG,EAAIA,EAAS,eAAeA,CAAM,GAClE,MAAMK,EAAM,MAAM,MAAMD,EAAM,CAC5B,OAAQ,OACR,QAAAD,EACA,KAAM,KAAK,UAAUF,CAAI,CAC7B,CAAG,EAED,GAAII,EAAI,GAAI,CACV,MAAMC,EAAO,MAAMD,EAAI,KAAI,EAC3B,GAAIC,EAAK,MAAQN,IAAW,QAC1B,OAAOM,EAET,GAAIA,EAAK,IACP,GAAI,CACF,QAAQ,eAAeN,CAAM,EAC7B,QAAQ,IAAI,WAAWA,CAAM,EAAE,EAC/B,QAAQ,IAAI,UAAWC,CAAI,EAC3B,IAAIM,EAAU,KAAK,MAAMD,EAAK,GAAG,EACjC,QAASE,KAAQD,EACf,QAAQ,IAAIC,CAAI,EAElB,QAAQ,SAAQ,CAClB,OAASC,EAAG,CACV,QAAQ,KAAK,gCAAiCA,CAAC,CACjD,CAEF,OAAOH,EAAK,OACd,KAAO,CACL,IAAII,EAAW,MAAML,EAAI,KAAI,EACzBM,EAAOC,EACX,GAAI,CACFD,EAAQ,KAAK,MAAMD,CAAQ,CAE7B,OAASD,EAAG,CAAC,CACb,IAAII,EAAa,CACf,CAACb,EAAQW,EAAM,SAAUA,EAAM,cAAc,EAAE,OAAO,OAAO,EAAE,KAAK,GAAG,CAC7E,EACI,GAAIA,EAAM,IAAK,CACbC,EAAYD,EAAM,IAClB,GAAI,CACFC,EAAY,KAAK,MAAMA,CAAS,EAAE,CAAC,EACnC,QAAQ,IAAIA,CAAS,CAEvB,OAASH,EAAG,CAAC,CACf,CACA,IAAIA,EAAI,IAAI,MAAMI,EAAW,KAAK;AAAA,CAAI,CAAC,EACvC,MAAAJ,EAAE,SAAWE,EAAM,SACnBF,EAAE,IAAMG,EACRH,EAAE,OAASJ,EAAI,OACfI,EAAE,SAAWE,EAAM,iBACf,KAAK,MAAMA,EAAM,gBAAgB,EACjC,CAAA,EACJF,EAAE,SAAWA,EAAE,SAAS,OAAOE,EAAM,OAAO,EAC5CF,EAAE,SAAWA,EAAE,SAAS,IAAK,GAAM,CACjC,GAAI,CACF,OAAO,KAAK,MAAM,CAAC,EAAE,OACvB,OAASE,EAAO,CACd,OAAO,CACT,CACF,CAAC,EACDF,EAAE,SAAWA,EAAE,SAAS,OAAO,OAAO,EACjCA,EAAE,SAAS,SACdA,EAAE,SAAWE,EAAM,eACf,CAACA,EAAM,cAAc,EACrB,CAAC,uBAAuB,GAG1BT,EAAQ,SACVA,EAAQ,QAAQ,CAAE,SAAUG,EAAK,OAAQA,EAAI,OAAQ,MAAOI,CAAC,CAAE,EAG3DA,CACR,CACF,GCvFY,MAACK,EAAqBC,EAAY,aAAc,IAAM,CAEhE,MAAMC,EAAcC,EAAI,CAAC,EACnBC,EAAaD,EAAI,CAAC,EAClBE,EAAcF,EAAI,EAAK,EACvBG,EAAgBH,EAAI,EAAE,EACtBI,EAAuBJ,EAAI,EAAE,EAC7BK,EAAgBL,EAAI,EAAE,EACtBM,EAAgBN,EAAI,EAAK,EAGzBO,EAAgBP,EAAI,EAAE,EAGtBQ,EAAWC,EAAS,IAAOV,EAAY,MAAQE,EAAW,MAAS,GAAG,EACtES,EAAcD,EAAS,IAAM,CACjC,OAAQV,EAAY,MAAK,CACvB,IAAK,GACH,MAAO,GACT,IAAK,GACH,OAAOI,EAAc,MAAM,OAAS,EACtC,IAAK,GACH,OAAOC,EAAqB,MAAM,OAAS,EAC7C,IAAK,GACH,MAAO,GACT,QACE,MAAO,EACf,CACE,CAAC,EAEKO,EAAmBF,EAAS,IAAMN,EAAc,MAAM,OAAS,CAAC,EAGtE,SAAeS,GAAW,QAAA9B,EAAA,sBACxB,GAAI,EAAAyB,EAAc,MAAM,OAAS,GAEjC,CAAAD,EAAc,MAAQ,GACtB,GAAI,CACF,MAAMb,EAAW,MAAMd,EAAK,sCAAsC,EAE9Dc,EAAS,SAAWA,EAAS,OAC/Bc,EAAc,MAAQd,EAAS,KAAK,IAAIoB,IAAQ,CAC9C,GAAIA,EAAI,SACR,KAAMA,EAAI,cAAgBA,EAAI,SAC9B,YAAaA,EAAI,YACjB,KAAMC,EAAWD,EAAI,QAAQ,EAC7B,MAAOE,EAAYF,EAAI,QAAQ,EAC/B,SAAUA,EAAI,SACd,SAAUA,EAAI,SACd,eAAgBA,EAAI,eACpB,YAAa,GACb,UAAWA,EAAI,WAAa,CAAA,CACtC,EAAU,EAEN,OAASnB,EAAO,CACd,QAAQ,MAAM,uBAAwBA,CAAK,CAC7C,QAAC,CACCY,EAAc,MAAQ,EACxB,EACF,GAEA,SAASQ,EAAWE,EAAS,CAU3B,MATc,CACZ,KAAQ,KACR,MAAS,KACT,QAAW,KACX,cAAiB,KACjB,WAAc,KACd,UAAa,KACb,KAAQ,IACd,EACiBA,CAAO,GAAK,IAC3B,CAEA,SAASD,EAAYE,EAAU,CAS7B,MARe,CACb,IAAO,gBACP,cAAiB,gBACjB,aAAgB,eAChB,QAAW,cACX,UAAa,gBACb,qBAAsB,aAC5B,EACkBA,CAAQ,GAAK,aAC7B,CAEA,SAASC,EAAQC,EAAM,CACrBpB,EAAY,MAAQoB,CACtB,CAEA,SAASC,GAAW,CACdrB,EAAY,MAAQE,EAAW,OACjCF,EAAY,OAEhB,CAEA,SAASsB,GAAe,CAClBtB,EAAY,MAAQ,GACtBA,EAAY,OAEhB,CAEA,SAASuB,EAAWC,EAAO,CACzB,MAAMV,EAAMN,EAAc,MAAM,KAAKiB,GAAKA,EAAE,KAAOD,CAAK,EACpDV,GAAO,CAACA,EAAI,cACdA,EAAI,YAAc,GAClBV,EAAc,MAAM,KAAKoB,CAAK,EAElC,CAEA,SAASE,EAAcF,EAAO,CAC5B,MAAMV,EAAMN,EAAc,MAAM,KAAKiB,GAAKA,EAAE,KAAOD,CAAK,EACpDV,IACFA,EAAI,YAAc,GAClBV,EAAc,MAAQA,EAAc,MAAM,OAAOuB,GAAMA,IAAOH,CAAK,EACnEnB,EAAqB,MAAQA,EAAqB,MAAM,OACtDuB,GAAe,CAACA,EAAY,SAASJ,CAAK,CAClD,EAEE,CAEA,SAASK,EAAeC,EAASC,EAAO,CACtC,MAAMC,EAAiB,GAAGF,CAAO,IAAIC,CAAK,GACrC1B,EAAqB,MAAM,SAAS2B,CAAc,GACrD3B,EAAqB,MAAM,KAAK2B,CAAc,CAElD,CAEA,SAASC,EAAkBD,EAAgB,CACzC3B,EAAqB,MAAQA,EAAqB,MAAM,OACtD6B,GAAOA,IAAQF,CACrB,CACE,CAEA,SAASG,EAAiBH,EAAgBI,EAAS,CACjD9B,EAAc,MAAM0B,CAAc,EAAII,CACxC,CAEA,SAASC,GAAqB,CAC5BlC,EAAY,MAAQ,GAEpBH,EAAY,MAAQ,CACtB,CAEA,SAASsC,GAAkB,CACzBtC,EAAY,MAAQ,EACpBG,EAAY,MAAQ,GACpBC,EAAc,MAAQ,CAAA,EACtBC,EAAqB,MAAQ,CAAA,EAC7BC,EAAc,MAAQ,CAAA,EACtBE,EAAc,MAAM,QAAQM,GAAO,CACjCA,EAAI,YAAc,EACpB,CAAC,CACH,CAEA,MAAO,CAEL,YAAAd,EACA,WAAAE,EACA,YAAAC,EACA,cAAAC,EACA,qBAAAC,EACA,cAAAC,EACA,cAAAE,EACA,cAAAD,EAGA,SAAAE,EACA,YAAAE,EACA,iBAAAC,EAGA,SAAAC,EACA,QAAAM,EACA,SAAAE,EACA,aAAAC,EACA,WAAAC,EACA,cAAAG,EACA,eAAAG,EACA,kBAAAI,EACA,iBAAAE,EACA,mBAAAE,EACA,gBAAAC,CACJ,CACA,CAAC","x_google_ignoreList":[0]}